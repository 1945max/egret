var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))(function(o,n){function s(t){try{h(r.next(t))}catch(e){n(e)}}function a(t){try{h(r["throw"](t))}catch(e){n(e)}}function h(t){t.done?o(t.value):new i(function(e){e(t.value)}).then(s,a)}h((r=r.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return r([t,e])}}function r(i){if(o)throw new TypeError("Generator is already executing.");for(;h;)try{if(o=1,n&&(s=n[2&i[0]?"return":i[0]?"throw":"next"])&&!(s=s.call(n,i[1])).done)return s;switch(n=0,s&&(i=[0,s.value]),i[0]){case 0:case 1:s=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,n=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(s=h.trys,!(s=s.length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){h.label=i[1];break}if(6===i[0]&&h.label<s[1]){h.label=s[1],s=i;break}if(s&&h.label<s[2]){h.label=s[2],h.ops.push(i);break}s[2]&&h.ops.pop(),h.trys.pop();continue}i=e.call(t,h)}catch(r){i=[6,r],n=0}finally{o=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var o,n,s,a,h={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},Common=function(){function t(){}return t.FRAME_STATUS=!0,t}();__reflect(Common.prototype,"Common");var Enemy=function(t){function e(e,i){var r=t.call(this)||this;return r.speedX=0,r.speedY=5,r.bulletArray=[],r.speedX=e,r.speedY=i,r.createBullet(),r}return __extends(e,t),e.prototype.shoot=function(){var t=this.bulletArray[this.bulletArray.length-1];t.x=this.x,t.y=this.y,this.bulletArray.pop(),t.shootToTarget(this.x,this.y,Common.player.x,Common.player.y)},e.prototype.createBullet=function(){for(var t=0;10>t;t++){var e=new BulletOfEnemy;e.graphics.beginFill(102,1),e.graphics.drawCircle(0,0,5),e.graphics.endFill(),e.name=this.name+"-bullet_"+t,this.bulletArray.push(e)}},e.prototype.addEventForRun=function(){this.addEventListener(egret.Event.ENTER_FRAME,this.operateEnemyRun,this)},e.prototype.removeEventForRun=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.operateEnemyRun,this)},e.prototype.operateEnemyRun=function(){Common.FRAME_STATUS&&(this.x+=this.speedX,this.y+=this.speedY,(this.y<=0||this.y>=this.parent.height||this.x<=0||this.x>=this.parent.height)&&(this.removeEventForRun(),this.parent.removeChild(this),Common.enemyMoveManager.enemyArray.push(this)))},e}(egret.Shape);__reflect(Enemy.prototype,"Enemy");var BulletOfEnemy=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.speed=10,e.speedX=0,e.speedY=0,e}return __extends(e,t),e.prototype.shootToTarget=function(t,e,i,r){this.x=t,this.y=e;var o=Math.abs(t-i),n=Math.abs(e-r),s=Math.sqrt(Math.pow(n,2)+Math.pow(n,2)),a=o/s;t-i>0?this.speedX=this.speed*a:0>t-i&&(this.speedX=-1*this.speed*a),e-r>0?this.speedY=Math.sqrt(Math.pow(this.speed,2)-Math.pow(this.speedX,2)):0>e-r&&(this.speedY=-1*Math.sqrt(Math.pow(this.speed,2)-Math.pow(this.speedX,2))),this.addEventForRun()},e.prototype.addEventForRun=function(){this.addEventListener(egret.Event.ENTER_FRAME,this.operateBulletRun,this)},e.prototype.removeEventForRun=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.operateBulletRun,this)},e.prototype.operateBulletRun=function(){Common.FRAME_STATUS&&(this.x+=this.speedX,this.y+=this.speedY,(this.y>=this.parent.height||this.x<=0||this.x>=this.parent.height)&&(this.removeEventForRun(),this.parent.removeChild(this),this.parent.getChildByName(this.name.split("-")[0]).bulletArray.push(this)))},e}(egret.Shape);__reflect(BulletOfEnemy.prototype,"BulletOfEnemy");var EnemyMoveManager=function(){function t(){this.enemyArray=[],this.spaceX=Common.gameStageContainer.width/Common.mapConfigs.stage_width,this.spaceY=Math.sqrt(2*Math.pow(Common.player.width,2)),this.indexs=Common.mapConfigs.enemy_team,this.createEnemy()}return t.prototype.createEnemy=function(){for(var t=Common.mapConfigs,e=0;e<t.enemy_count;e++){var i=new Enemy(0,4);i.graphics.beginFill(26367,1),i.graphics.drawRect(0,-Common.player.width,Common.player.width,Common.player.width),i.graphics.endFill(),i.rotation=45,i.name="enemy_"+e,this.enemyArray.push(i)}},t.prototype.operateEnemyRun=function(t){if(this.indexs.length>0&&this.indexs[this.indexs.length-1].time==t)for(var e=this.indexs.pop(),i=0;i<e.enemy.length;i++){var r=this.enemyArray.pop();r.y=0,r.x=this.spaceX*e.enemy[i]-this.spaceY/2,console.log(r.x+"_"+r.y),Common.gameStageContainer.addChild(r),r.addEventForRun()}},t}();__reflect(EnemyMoveManager.prototype,"EnemyMoveManager");var GameStageContainer=function(t){function e(e,i,r,o){var n=t.call(this)||this;return n.x=e,n.y=i,n.width=r,n.height=o,n.createScreen(r,o),n.createPointPanel(r,o),n}return __extends(e,t),e.prototype.createScreen=function(t,e){var i=new egret.Shape;i.graphics.beginFill(4473924,1),i.graphics.drawRect(0,0,t,e),i.graphics.endFill(),this.addChild(i),this.setChildIndex(i,1)},e.prototype.createPointPanel=function(t,e){this.pointPanel=new PointPanel(0,0,t,e),this.addChild(this.pointPanel),this.setChildIndex(this.pointPanel,100)},e}(egret.DisplayObjectContainer);__reflect(GameStageContainer.prototype,"GameStageContainer");var PointPanel=function(t){function e(e,i,r,o){var n=t.call(this)||this;return n.point=0,n.time=new egret.Timer(1e3,-1),n.timeStr=0,n.HP=3,n.HPArray=[],n.boom=3,n.boomArray=[],n.x=e,n.y=i,n.width=r,n.height=o,n.createContent(),n}return __extends(e,t),e.prototype.createContent=function(){var t=new egret.TextField;t.text=this.point+"",t.size=40,t.textColor=16773120,t.x=10,t.y=10,this.addChild(t),this.setChildIndex(t,3);var e=new egret.TextField;e.text=this.timeStr+"",e.size=40,e.textColor=16776942,e.x=this.width-10-e.width,e.y=10,this.addChild(e),this.setChildIndex(e,3);for(var i=0;i<this.HP;i++){var r=new egret.Shape;r.graphics.beginFill(16711680,1),r.graphics.drawRect(10,this.height-10-20,40,20),r.graphics.endFill(),r.x+=40*i+10*i,this.addChild(r),this.setChildIndex(r,3),this.HPArray.push(r);var o=new egret.Shape;o.graphics.beginFill(6711039,1),o.graphics.drawRect(this.width-150,this.height-10-20,40,20),o.graphics.endFill(),o.x+=40*i+10*i,this.addChild(o),this.setChildIndex(o,3),this.boomArray.push(o)}},e.prototype.removeBoom=function(){this.boom--;for(var t=0,e=this.boomArray;t<e.length;t++){var i=e[t];if(i.parent)return void i.parent.removeChild(i)}},e.prototype.addBoom=function(){this.boom++;for(var t=this.boomArray.length-1;t>=0;t--)if(!this.boomArray[t].parent)return void this.boomArray[t].parent.addChild(this.boomArray[t])},e.prototype.removeHP=function(){this.HP--;for(var t=0,e=this.HPArray;t<e.length;t++){var i=e[t];if(i.parent)return void i.parent.removeChild(i)}},e.prototype.addHP=function(){this.HP++;for(var t=this.HPArray.length-1;t>=0;t--)if(!this.HPArray[t].parent)return void this.HPArray[t].parent.addChild(this.HPArray[t])},e}(egret.DisplayObjectContainer);__reflect(PointPanel.prototype,"PointPanel");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,RES.loadGroup("preload",1,t)];case 2:return i.sent(),this.stage.removeChild(t),[3,4];case 3:return e=i.sent(),console.error(e),[3,4];case 4:return[2]}})})},e.prototype.createGameScene=function(){e.stageWidth=this.stage.stageWidth,e.stageHeight=this.stage.stageHeight;var t=new egret.Shape;t.graphics.beginFill(8684676,1),t.graphics.drawRect(0,0,e.stageWidth,e.stageHeight),t.graphics.endFill(),this.addChild(t);var i=new egret.Shape;i.graphics.beginFill(0,1),i.graphics.drawRoundRect(20,20,e.stageWidth-40,e.stageWidth-40,40,40),i.graphics.endFill(),this.addChild(i),Common.gameStageContainer=new GameStageContainer(40,40,e.stageWidth-80,e.stageWidth-80),this.addChild(Common.gameStageContainer);var r=new Player;r.graphics.beginFill(3394611,1),r.graphics.drawCircle(0,0,20),r.graphics.endFill(),r.x=Common.gameStageContainer.width/2,r.y=Common.gameStageContainer.height-50,Common.player=r,Common.gameStageContainer.addChild(r),Common.gameStageContainer.setChildIndex(r,20),Common.gameStageContainer.swapChildren(r,Common.gameStageContainer.pointPanel);var o=new egret.Shape;o.graphics.beginFill(0,1),o.graphics.drawRect(0,0,Common.gameStageContainer.width,Common.gameStageContainer.height),o.graphics.endFill(),o.x=Common.gameStageContainer.x,o.y=Common.gameStageContainer.y,this.addChild(o),Common.gameStageContainer.mask=o;var n=e.stageWidth/6;e.rockerX=n+40,e.rockerY=7*n+20;var s=new egret.Shape;s.graphics.beginFill(0,1),s.graphics.drawCircle(0,0,n),s.graphics.endFill(),s.x=e.rockerX,s.y=e.rockerY,this.addChild(s);var a=new egret.Shape,h=n-40;a.graphics.beginFill(15204352,1),a.graphics.drawCircle(0,0,h),a.graphics.endFill(),a.x=e.rockerX,a.y=e.rockerY,this.addChild(a),a.touchEnabled=!0,a.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){this.rockerEvent(t,h,a)},this),a.addEventListener(egret.TouchEvent.TOUCH_MOVE,function(t){this.rockerEvent(t,h,a)},this),a.addEventListener(egret.TouchEvent.TOUCH_END,function(t){a.x=e.rockerX,a.y=e.rockerY;var i=Math.abs(t.stageX-e.rockerX),r=Math.abs(t.stageY-e.rockerY),o=Math.sqrt(Math.pow(r,2)+Math.pow(i,2)),n=i/o;Common.player.setOption(n,t.stageX,t.stageY,e.rockerX,e.rockerY),Common.player.removeEventForRun()},this),a.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(t){a.x=e.rockerX,a.y=e.rockerY;var i=Math.abs(t.stageX-e.rockerX),r=Math.abs(t.stageY-e.rockerY),o=Math.sqrt(Math.pow(r,2)+Math.pow(i,2)),n=i/o;Common.player.setOption(n,t.stageX,t.stageY,e.rockerX,e.rockerY),Common.player.removeEventForRun()},this);var p=new egret.Shape;p.graphics.beginFill(15204352,1),p.graphics.drawCircle(e.stageWidth-n+20,7*n-20,n-40),p.graphics.endFill(),p.touchEnabled=!0,p.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){p.alpha=.5,Common.player.longShoot()},this),p.addEventListener(egret.TouchEvent.TOUCH_END,function(t){p.alpha=1,Common.player.stopShoot()},this),this.addChild(p);var c=new egret.Shape;c.graphics.beginFill(15204352,1),c.graphics.drawCircle(e.stageWidth-n+20-(2*n-80),7*n+2*n-120,n-40),c.graphics.endFill(),c.touchEnabled=!0,c.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){c.alpha=.5,Common.player.boom()},this),c.addEventListener(egret.TouchEvent.TOUCH_END,function(t){c.alpha=1},this),this.addChild(c);var d=new egret.Shape;d.graphics.beginFill(12763842,1),d.graphics.drawRoundRect(0,0,40,n,20,20),d.graphics.endFill(),d.rotation=-30,d.x=e.stageWidth/2-140,d.y=e.stageHeight-n-20,this.addChild(d),d.touchEnabled=!0,d.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){Common.FRAME_STATUS=!Common.FRAME_STATUS,Common.system.timer.stop(),d.alpha=.5},this),d.addEventListener(egret.TouchEvent.TOUCH_END,function(t){Common.system.timer.start(),d.alpha=1},this),this.addChild(c);var l=new egret.Shape;l.graphics.beginFill(12763842,1),l.graphics.drawRoundRect(0,0,40,n,20,20),l.graphics.endFill(),l.rotation=-30,l.x=e.stageWidth/2-60,l.y=e.stageHeight-n-20,this.addChild(l),Common.mapConfigs=RES.getRes("mapConfig_json"),Common.enemyMoveManager=new EnemyMoveManager,console.log(JSON.stringify(Common.mapConfigs)),Common.system=new System,this.playBgm()},e.prototype.playBgm=function(){var t=RES.getRes("bgm_mp3");e.soundChannel=t.play(0,-1)},e.prototype.rockerEvent=function(t,i,r){var o=Math.abs(t.stageX-e.rockerX),n=Math.abs(t.stageY-e.rockerY),s=Math.sqrt(Math.pow(n,2)+Math.pow(o,2)),a=o/s;if(s>i){var h=i*a,p=Math.sqrt(Math.pow(i,2)-Math.pow(h,2));t.stageX-e.rockerX>0?r.x=e.rockerX+h:t.stageX-e.rockerX<0?r.x=e.rockerX-h:r.x=e.rockerX,t.stageY-e.rockerY>0?r.y=e.rockerY+p:t.stageY-e.rockerY<0?r.y=e.rockerY-p:r.y=e.rockerY}else r.x=t.stageX,r.y=t.stageY;Common.player.setOption(a,t.stageX,t.stageY,e.rockerX,e.rockerY),Common.player.addEventForRun()},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var Player=function(t){function e(){var e=t.call(this)||this;return e.speed=5,e.bulletArray=[],e.boomBox=[],e.createBulletArray(),e.createBoomArray(),e}return __extends(e,t),e.prototype.setOption=function(t,e,i,r,o){this.cos=t,this.stageX=e,this.stageY=i,this.oX=r,this.oY=o},e.prototype.longShoot=function(){Common.FRAME_STATUS&&(this.shoot(),this.shootId=setTimeout(function(){Common.player.longShoot()},200))},e.prototype.stopShoot=function(){clearTimeout(this.shootId)},e.prototype.shoot=function(){var t=this.bulletArray.pop();t.x=this.x,t.y=this.y,t.addEventForRun(),this.parent.addChild(t),this.parent.swapChildren(t,this),this.parent.swapChildren(this,Common.gameStageContainer.pointPanel)},e.prototype.createBulletArray=function(){for(var t=0;10>t;t++){var e=new Bullet;e.graphics.beginFill(16737945,1),e.graphics.drawCircle(0,0,5),e.graphics.endFill(),e.name="bullet_"+t,this.bulletArray.push(e)}},e.prototype.boom=function(){if(Common.FRAME_STATUS&&Common.gameStageContainer.pointPanel.boom>=1){Common.gameStageContainer.pointPanel.removeBoom();var t=this.boomBox[2];this.boomBox[2]=this.boomBox[1],this.boomBox[1]=this.boomBox[0],this.boomBox[0]=t;for(var e=0,i=t;e<i.length;e++){var r=i[e];r.x=this.x,r.y=this.y,r.addEventForRun(),this.parent.addChild(r),this.parent.swapChildren(r,this)}}},e.prototype.createBoomArray=function(){for(var t=[],e=1;5>e;e++)for(var i=0;5>i;i++){var r=[];r.push(Math.cos(10*i)),r.push(e),t.push(r)}for(var e=0;3>e;e++){for(var o=[],i=0;i<t.length;i++){var n=new Boom(t[i][0],t[i][1]);n.graphics.beginFill(13369497,1),n.graphics.drawCircle(0,0,5),n.graphics.endFill(),n.name="boom_"+e+"_"+i,o.push(n)}this.boomBox.push(o)}},e.prototype.checkBorder=function(t){var e,i;t>0?(i=this.speed*t,e=Math.sqrt(Math.pow(this.speed,2)-Math.pow(i,2))):i=e=this.speed,this.x>=Common.gameStageContainer.width-this.width&&(this.x-=i),this.x<this.width&&(this.x+=i),this.y>=Common.gameStageContainer.height-this.height&&(this.y-=e),this.y<this.height&&(this.y+=e)},e.prototype.addEventForRun=function(){this.hasEventListener(egret.Event.ENTER_FRAME)||this.addEventListener(egret.Event.ENTER_FRAME,this.operatePlayerRun,this)},e.prototype.removeEventForRun=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.operatePlayerRun,this)},e.prototype.operatePlayerRun=function(){if(Common.FRAME_STATUS)switch(this.computeQuadrant()){case 1:this.x=this.x-this.speed*this.cos,this.y=this.y-Math.sqrt(Math.pow(this.speed,2)-Math.pow(this.speed*this.cos,2)),this.checkBorder(this.cos);break;case 2:this.x=this.x+this.speed*this.cos,this.y=this.y-Math.sqrt(Math.pow(this.speed,2)-Math.pow(this.speed*this.cos,2)),this.checkBorder(this.cos);break;case 3:this.x=this.x+this.speed*this.cos,this.y=this.y+Math.sqrt(Math.pow(this.speed,2)-Math.pow(this.speed*this.cos,2)),this.checkBorder(this.cos);break;case 4:this.x=this.x-this.speed*this.cos,this.y=this.y+Math.sqrt(Math.pow(this.speed,2)-Math.pow(this.speed*this.cos,2)),this.checkBorder(this.cos);break;default:this.stageX-this.oX>0?this.x+=this.speed:this.stageX-this.oX<0&&(this.x-=this.speed),this.stageY-this.oY>0?this.y+=this.speed:this.stageY-this.oY<0&&(this.y-=this.speed),this.checkBorder(0)}},e.prototype.computeQuadrant=function(){return this.stageX-this.oX<0&&this.stageY-this.oY<0?1:this.stageX-this.oX>0&&this.stageY-this.oY<0?2:this.stageX-this.oX>0&&this.stageY-this.oY>0?3:this.stageX-this.oX<0&&this.stageY-this.oY>0?4:0},e}(egret.Shape);__reflect(Player.prototype,"Player");var Bullet=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.speed=10,e}return __extends(e,t),e.prototype.addEventForRun=function(){this.addEventListener(egret.Event.ENTER_FRAME,this.operateBulletRun,this)},e.prototype.removeEventForRun=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.operateBulletRun,this)},e.prototype.operateBulletRun=function(){Common.FRAME_STATUS&&(this.y-=this.speed,this.y<=this.width&&(Common.player.bulletArray.push(this),this.removeEventForRun(),this.parent&&this.parent.removeChild(this)))},e}(egret.Shape);__reflect(Bullet.prototype,"Bullet");var Boom=function(t){function e(e,i){var r=t.call(this)||this;return r.speed=10,r.speedX=0,r.speedY=0,r.quadrant=1,r.cos=0,r.cos=e,r.quadrant=i,r.computeRun(),r}return __extends(e,t),e.prototype.computeRun=function(){switch(this.quadrant){case 1:this.speedX=-1*this.speed*this.cos,this.speedY=-1*Math.sqrt(Math.pow(this.speed,2)-Math.pow(this.speed*this.cos,2));break;case 2:this.speedX=this.speed*this.cos,this.speedY=-1*Math.sqrt(Math.pow(this.speed,2)-Math.pow(this.speed*this.cos,2));break;case 3:this.speedX=this.speed*this.cos,this.speedY=Math.sqrt(Math.pow(this.speed,2)-Math.pow(this.speed*this.cos,2));break;case 4:this.speedX=-1*this.speed*this.cos,this.speedY=Math.sqrt(Math.pow(this.speed,2)-Math.pow(this.speed*this.cos,2))}},e.prototype.addEventForRun=function(){this.addEventListener(egret.Event.ENTER_FRAME,this.operateBoomRun,this)},e.prototype.removeEventForRun=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.operateBoomRun,this)},e.prototype.operateBoomRun=function(){Common.FRAME_STATUS&&(this.y+=this.speedY,this.x+=this.speedX,(this.y<=0||this.y>=this.parent.height||this.x<=0||this.x>=this.parent.height)&&(this.removeEventForRun(),this.parent.removeChild(this)))},e}(egret.Shape);__reflect(Boom.prototype,"Boom");var System=function(){function t(){this.init()}return t.prototype.init=function(){this.timer=new egret.Timer(1e3,Common.mapConfigs.time),this.timer.addEventListener(egret.TimerEvent.TIMER,function(t){Common.enemyMoveManager.operateEnemyRun(Common.system.timer.currentCount)},this),this.timer.start()},t}();__reflect(System.prototype,"System");